<%- include ./partials/head %>
  <title>ATI</title>
  </head>

  <!-- <body onload="uncheckall()"> -->

  <body onload="defaultSetup()" lang="<%= __('html.lang') %>">
    <nav class="navbar navbar-default navbar-noMargin " style="padding-right:1%">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/" touched="/">ATI -
            <%= __('navbar.questionnaire') %>
          </a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right" style="height:100%">

            <li class="li-header-right">
              <!-- class="imgLangSmall li-header-right" style="margin-right: -5%"> -->
              <a href="" onclick="changeLang()" touchend="changeLang()">
                <img src="./images/lang_de_en.png" class="langImgQuestionnaire">

              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <%- include ./partials/JSalert %>

      <div id="questionnaireMain">
        <div class="container">
          <h1>
            <%= __('titleQuestionnaire') %>
          </h1>
          <p>
            <%- __('descQuestionnaire') %>
          </p>
          <p>
            <%- __('descQuestionnaire2') %>
          </p>
          <p>
            <%- __('descQuestionnaire3') %>
          </p>
          <div class="container separator"></div>
        </div>

        <div class="container">
          <form action="" onSubmit="return false;">
            <div class="flex-row flex-s-col">
              <div class="flex-col token" s>
                <label for="first-letter-birthplace">
                  <%= __('createId.descFirstBirthplace') %>
                </label>
                <input type="text" name="first-letter-birthplace" pattern="[a-zA-Z]" required title="1 character">
              </div>
              <div class="dummie-container"></div>
              <div class="flex-col token">
                <label for="last-letter-birthplace">
                  <%= __('createId.descLastBirthplace') %>
                </label>
                <input type="text" name="last-letter-birthplace" pattern="[a-zA-Z]" required title="1 character">
              </div>
            </div>
            <div class="flex-row flex-s-col">
              <div class="flex-col token">
                <label for="birthday" id="bday">
                  <%= __('createId.descBirthday') %>
                </label>
                <input type="number" name="birthday" min="01" max="31" pattern=".{2,2}" required oninput="checkForBirthday(this)" placeholder="00">
              </div>
              <div class="dummie-container"></div>
              <div class="flex-col token">
                <label for="country">
                  <%= __('createId.descGeburtsland') %>
                </label>
                <input type="text" name="country" pattern=".{2,2}" required title="2 character">
              </div>
            </div>
            <div class="flex-row flex-s-col">
              <div class="flex-col token">
                <label for="father">
                  <%= __('createId.descFirstFather') %>
                </label>
                <input type="text" name="father" min="01" max="31" pattern="[a-zA-Z]" required title="1 character">
              </div>
              <div class="dummie-container"></div>
              <div class="flex-col token">
                <label for="mother">
                  <%= __('createId.descFirstMother') %>
                </label>
                <input type="text" name="mother" pattern=".{1,1}" required title="1 character">
              </div>
            </div>

            <div class="">
              <div class="separator"> </div>
              <!-- questions -->
              <!-- head -->

              <div class="row desc-questions">
                <div class="col-xs-12 col-md-5">
                  <strong>
                    <%= __('instruction') %>
                  </strong>
                </div>
                <div class="ans-vis text-justify" id="instructions">
                  <div class="col-md-1"></div>

                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer1') %>
                  </div>

                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer2') %>
                  </div>
                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer3') %>
                  </div>
                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer4') %>
                  </div>
                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer5') %>
                  </div>
                  <div class="col-sm-2 col-md-1 text-md-center">
                    <%= __('answers.answer6') %>
                  </div>
                </div>
              </div>
              <!-- questions -->
              <div class="separator-div"></div>
              <div id="questions" class="container">
                <!-- question1 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q1" id="q1">
                      <%= __('questions.question1') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center " onclick="checkRadio('q1',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <input type="radio" name="q1" value="<%= i %>" required>
                          <span class="answer-question-vis">
                            <%= __('answers.answer' +i) %>
                          </span>
                        </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question2 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q2" id="q2">
                      <%= __('questions.question2') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q2',<%= i -1 %>)" touchend="checkRadio('q2',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q2" value="<%= i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question3 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q3" id="q3">
                      <%= __('questions.question3') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q3',<%= i -1 %>)" touchend="checkRadio('q3',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q3" value="<%= 7 - i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question4 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q4" id="q4">
                      <%= __('questions.question4') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q4',<%= i -1 %>)" touchend="checkRadio('q4',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q4" value="<%= i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question5 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q5" id="q5">
                      <%= __('questions.question5') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q5',<%= i -1 %>)" touchend="checkRadio('q5',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q5" value="<%= i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question6 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q6" id="q6">
                      <%= __('questions.question6') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q6',<%= i -1 %>)" touchend="checkRadio('q6',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q6" value=" <%= 7 - i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question7 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q7" id="q7">
                      <%= __('questions.question7') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q7',<%= i -1 %>)" touchend="checkRadio('q7',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q7" value="<%=i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question8 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q8" id="q8">
                      <%= __('questions.question8') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q8',<%= i -1 %>)" touchend="checkRadio('q8',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q8" value=" <%= 7 - i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
                <!-- question9 -->
                <div class="row">
                  <div class="col-xs-12 col-md-5">
                    <label for="q9" id="q9">
                      <%= __('questions.question9') %>
                    </label>
                  </div>
                  <div>
                    <div class="col-md-1"></div>
                    <% for(var i = 1; i < 7 ; i++){%>
                      <div class="col-xs-12 col-md-1 questionaire-height-md text-md-center" onclick="checkRadio('q9',<%= i -1 %>)" touchend="checkRadio('q9',<%= i -1 %>)">
                        <span class="vertical-btn questionnaire-radio">
                          <span class="vertical-btn ">
                            <input type="radio" name="q9" value=" <%= i %>" required>
                            <span class="answer-question-vis">
                              <%= __('answers.answer' +i) %>
                            </span>
                          </span>
                      </div>
                      <% } %>
                  </div>
                </div>
              </div>
            </div>


            <div>
              <div class="separator"> </div>
              <!-- demographic data -->
              <div id="dempographic-data">
                <!-- sex -->
                <div class="demo-elem demo" id="sex">
                  <div class="row demoData">
                    <div class="col-xs-12 col-md-4">
                      <label for="sex">
                        <%= __('sex.desc') %>:</label>
                    </div>
                    <div class="row col-md-8">
                      <div class=" col-xs-12 col-sm-4 col-md-3" onclick="checkRadio('sex',0)" touchend="checkRadio('sex',0)">
                        <input type="radio" name="sex" value="1" required>
                        <%= __('sex.male') %>
                      </div>
                      <div class="col-xs-12 col-sm-4 col-md-3" onclick="checkRadio('sex',1)" touchend="checkRadio('sex',1)">
                        <input type="radio" name="sex" value="2" required>
                        <%= __('sex.female') %>
                      </div>
                      <div class="col-xs-12 col-sm-4 col-md-3" onclick="checkRadio('sex',2)" touchend="checkRadio('sex',2)">
                        <input type="radio" name="sex" value="3" required>
                        <%= __('sex.other') %>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- age -->
                <div class="demo-elem demo" id="age">
                  <div class="row demoData">
                    <div class="col-xs-12 col-md-4">
                      <label for="age" class="age-label">
                        <%= __('age.desc') %>:
                      </label>
                    </div>
                    <div class="col-xs-3 col-md-1 ">
                      <input type="number" min="0" max="150" name="age" class="vertical" required placeholder="0" id="age-Input"> </div>
                    <div class="col-xs-9 col-md-7">
                      <p>
                        <%= __('age.unit') %>
                      </p>
                    </div>
                  </div>
                </div>
                <!-- education -->
                <div class="demo-elem demo" id="education">
                  <div class="row demoData">
                    <div class="col-xs-12 ">
                      <label for="edu" id="defEdu">
                        <%= __('educationLevel.desc') %>:
                      </label>
                    </div>
                  </div>
                  <div class="row" style="text-align: left">
                    <div class="col-xs-12 " style="white-space: nowrap;" onclick="checkRadio('edu',0)" touchend "checkRadio('edu',0)">
                      <!-- css-class? -->
                      <input type="radio" name="edu" value="1" required>
                      <%= __('educationLevel.noCertificate') %>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',1)" touchend="checkRadio('edu',1)">
                      <input type="radio" name="edu" value="2" required>
                      <span>
                        <%= __('educationLevel.lesserThanAbitur') %>
                      </span>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',2)" touchend="checkRadio('edu',2)">
                      <input type="radio" name="edu" value="3" required>
                      <%= __('educationLevel.aLevel') %>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',3)" touchend="checkRadio('edu',3)">

                      <input type="radio" name="edu" value="4" required>
                      <%= __('educationLevel.BMD') %>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',4)" touchend="checkRadio('edu',4)">
                      <input type="radio" name="edu" value="5" required>
                      <%= __('educationLevel.hMD') %>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',5)" touchend="checkRadio('edu',5)">
                      <input type="radio" name="edu" value="6" required>
                      <%= __('educationLevel.vocationalSchool') %>
                    </div>
                    <div class="col-xs-12 " onclick="checkRadio('edu',6)" touchend="checkRadio('edu',6)">
                      <input type="radio" name="edu" value="7" required>
                      <%= __('educationLevel.masterCraftsman') %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="separator" id="sepDiv"></div>
            <div id="dontSendDataDiv" class="container">
              <div class="flex-row">
                <div>
                  <input type="checkbox" id="dontSendData" name="dontSendData">
                </div>
                <div onclick="dntSend()" touchend="dntSend()">
                  <span>
                    <%= __('questionnaire.dontSend1') %>
                      <strong>
                        <%= __('questionnaire.dontSend2') %>
                      </strong>
                      <%= __('questionnaire.dontSend3') %>
                  </span>
                </div>
              </div>
              <div class="container" align="center">
               <button class="button  button-start bg-color-theme btn-sbmt" onclick="checkAnswers(),showResult(), defaultScale()" touchend="checkAnswers(),showResult(), defaultScale()">
                  <%= __('btn.submit') %>
                </button>
              </div>
            </div>     
        </div>
        </form>

      </div>
      <div id="questionnaireResult" class="container index-padding-bottom" style="display:none;" align="center">
        <div class="row">
          <div class="col-xs-6 col-sm-2">
              <a href="/"><button class="bg-color-theme btn-home btn-home-margin">Home</button></a> 
          </div>
          <div class="col-xs-12 col-sm-10">
            <p>
              <%= __('questionnaire.result') %>
            </p>
          </div>         
        </div>
        <div class="row">
          <div class="col-sm-2"></div>
          <div class="col-sm-10">
            <h3>
              <%= __('questionnaire.resultDesc1') %>
                <strong>
                  <span id="uSc"></span>
                </strong>
                <%= __('questionnaire.resultDesc2') %>
              </h3>
            <p>
              <%= __('questionnaire.result2') %>
            </p>
          </div>
        </div>

        <div id="chart">
          <div id="defaultChart" class="ct-chart ct-perfect-fourth"></div>

          <div id="ageChart" class="ct-chart ct-perfect-fourth" style="display:none"></div>

          <div id="sexChart" class="ct-chart ct-perfect-fourth" style="display:none">

          </div>
          <p id="descDef">
            <%= __('chart.descDef') %>
          </p>
        </div>
        <div align="center" class="white-color">
          <button id="defC" onclick="defaultScale(),showChart('defaultChart')" touchend="defaultScale(),showChart('defaultChart')"
            class="button bg-color-theme">
            <%= __('chart.default') %>
          </button>
          <button id="ageC" onclick="ageScale(),showChart('ageChart')" touchend="ageScale(), showChart('ageChart')" class="button bg-color-theme">
            <%= __('chart.age') %>
          </button>
          <button id="sexC" onclick="sexScale(),showChart('sexChart')" touchend="sexScale(), showChart('sexChart')" class="button bg-color-theme">
            <%= __('chart.sex') %>
          </button>
        </div>
      </div>
      </div>
      <script src="./chartist/dist/chartist.min.js"></script>
      <script src="./js/form.js"></script>
      <script>
        function defaultScale() {
          // var url = '/db/get/buckets';
          var url = '/db/buckets';
          var options = {
            height: '75%',
            axisY: {
              onlyInteger: true,
            },
          };
          fetch(url)
            .then(res => res.json())
            .then((out) => {
              var data = {
                labels: ['[1,2)', '[2,3)', '[3,4)', '[4,5)', '[5,6]'],
                series: [
                  []
                ]
              };            
              for (i = 0; i < 5; i++) {
                data.series[0][i] = out[i].amount;
              };
              new Chartist.Bar('#defaultChart', data, options);

            })
            .catch(err => {
              throw err
            });
        }

        function ageScale() {
          var url = '/db/ageAndAti';
          var options = {
            showLine: false,
            axisX: {
              type: Chartist.AutoScaleAxis,
              onlyInteger: true
            },
            height: '75%'
          };
          var data = {
            labels: [],
            series: [
              []
            ]
          };

          fetch(url)
            .then(res => res.json())
            .then((out) => {
              for (i = 0; i < out.length; i++) {
                data.series[0][i] = {
                  x: out[i].age,
                  y: out[i].score
                };
              };
              new Chartist.Bar('#ageChart', data, options);
            })
            .catch(err => {
              throw err
            });
        }

        function showChart(elem) {
          if (elem === 'ageChart') {
            document.querySelector('#ageChart').style.display = 'block';
            document.getElementById('ageC').classList.add('highlighted-scale');
            document.getElementById('ageC').classList.remove('bg-color-theme');
            document.getElementById('sexC').classList.remove('highlighted-scale');
            document.getElementById('sexC').classList.add('bg-color-theme');
            document.getElementById('defC').classList.remove('highlighted-scale');
            document.getElementById('defC').classList.add('bg-color-theme');
            document.querySelector('#defaultChart').style.display = 'none';
            document.querySelector('#sexChart').style.display = 'none';
            showDesc('age');

          } else if (elem === 'defaultChart') {
            document.querySelector('#defaultChart').style.display = 'block';
            document.getElementById('defC').classList.add('highlighted-scale');
            document.getElementById('defC').classList.remove('bg-color-theme');
            document.getElementById('sexC').classList.remove('highlighted-scale');
            document.getElementById('sexC').classList.add('bg-color-theme');
            document.getElementById('ageC').classList.remove('highlighted-scale');
            document.getElementById('ageC').classList.add('bg-color-theme');
            document.querySelector('#ageChart').style.display = 'none';
            document.querySelector('#sexChart').style.display = 'none';
            showDesc('def');

          } else if (elem === 'sexChart') {
            document.querySelector('#defaultChart').style.display = 'none';
            document.querySelector('#ageChart').style.display = 'none';
            document.querySelector('#sexChart').style.display = 'block';
            document.getElementById('sexC').classList.add('highlighted-scale');
            document.getElementById('sexC').classList.remove('bg-color-theme');
            document.getElementById('ageC').classList.remove('highlighted-scale');
            document.getElementById('ageC').classList.add('bg-color-theme');
            document.getElementById('defC').classList.remove('highlighted-scale');
            document.getElementById('defC').classList.add('bg-color-theme');
            showDesc('sex');

          }

        }

        function showDesc(elem) {
          let a = document.getElementById('descDef');
          if (elem === 'def') {
            a.innerHTML = '<%= __('chart.descDef') %>';
          } else if (elem === 'age') {
            a.innerHTML = '<%= __('chart.descAge') %>';
          } else if (elem === 'sex') {
            a.innerHTML = '<%= __('chart.descSex') %>';
          }
        }

        function sexScale() {
          var url = '/db/sexAndAti';
          var m = '<%= __('sex.male') %>';
          var f = '<%= __('sex.female') %>';
          var o = '<%= __('sex.other') %>';
          var options = {
            showLine: false,
            axisX: {
              //type: Chartist.AutoScaleAxis,
              //onlyInteger: true
            },
            seriesBarDistance: 15,
            height: '75%'
          };
          var data = {
            labels: [m, f, o],
            series: [[]]
          };

          fetch(url)
            .then(res => res.json())
            .then((out) => {
              var male = 0;
              var maleCounter = 0;
              var female = 0;
              var femaleCounter = 0;
              var other = 0;
              var otherCounter = 0;
              for (i = 0; i < out.length; i++) {
                if (out[i].sex === 3) {

                  other += out[i].score;
                  otherCounter += 1;
                } else if (out[i].sex === 1) {
                  male += out[i].score;
                  maleCounter += 1;
                } else if (out[i].sex === 2) {
                  female += out[i].score;
                  femaleCounter += 1;
                }
              };
              data.series[0][0] = { x: 'male', y: male / maleCounter }
              data.series[0][1] = { x: 'female', y: female / femaleCounter }
              data.series[0][2] = { x: 'other', y: other / otherCounter }
              new Chartist.Bar('#sexChart', data, options);
            })
            .catch(err => { throw err });
        }
      </script>
  </body>